<mat-card>
  <mat-card-header>
    <mat-card-title>{{ isEditMode ? 'Editar' : 'Novo' }} Produto</mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <!-- FORM GROUP NO ELEMENTO PAI -->
    <form [formGroup]="produtoForm" (ngSubmit)="onSubmit()">

      <!-- Código (alterado para texto) -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Código</mat-label>
        <input matInput formControlName="codigo">
        <mat-error *ngIf="produtoForm.get('codigo')?.hasError('required')">
          Código é obrigatório
        </mat-error>
        <mat-error *ngIf="produtoForm.get('codigo')?.hasError('maxlength')">
          Código deve ter no máximo 50 caracteres
        </mat-error>
      </mat-form-field>

      <!-- Descrição -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Descrição</mat-label>
        <textarea matInput formControlName="descricao" placeholder="Digite a descrição" rows="1"></textarea>
        <mat-error *ngIf="produtoForm.get('descricao')?.hasError('required')">
          Descrição é obrigatória
        </mat-error>
        <mat-error *ngIf="produtoForm.get('descricao')?.hasError('maxlength')">
          Descrição deve ter no máximo 500 caracteres
        </mat-error>
      </mat-form-field>

      <!-- Departamento (alterado para armazenar apenas o código) -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Departamento</mat-label>
        <mat-select formControlName="departamentoCodigo">
          <mat-option *ngFor="let departamento of departamentos" [value]="departamento.codigo">
            {{ departamento.codigo }} - {{ departamento.descricao }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="produtoForm.get('departamentoCodigo')?.hasError('required')">
          Departamento é obrigatório
        </mat-error>
      </mat-form-field>

      <!-- Preço -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Preço</mat-label>
        <input matInput type="number" formControlName="preco" placeholder="0.00" step="0.01" min="0.01">
        <span matTextPrefix>R$&nbsp;</span>
        <mat-error *ngIf="produtoForm.get('preco')?.hasError('required')">
          Preço é obrigatório
        </mat-error>
        <mat-error *ngIf="produtoForm.get('preco')?.hasError('min')">
          Preço deve ser maior que zero
        </mat-error>
      </mat-form-field>

      <!-- Status -->
      <mat-slide-toggle formControlName="status" color="primary">
        {{ produtoForm.get('status')?.value ? 'Ativo' : 'Inativo' }}
      </mat-slide-toggle>

      <!-- Botões -->
      <div class="button-container">
        <button type="button" mat-button (click)="voltar()">Cancelar</button>
        <button type="submit" mat-raised-button color="primary" [disabled]="produtoForm.invalid || submitting">
          {{ submitting ? 'Salvando...' : (isEditMode ? 'Atualizar' : 'Criar') }}
        </button>
      </div>

    </form>
  </mat-card-content>
</mat-card>

<!-- Loading -->
<div *ngIf="loading" class="loading-overlay">
  <mat-spinner></mat-spinner>
</div>
